CMAKE_MINIMUM_REQUIRED(VERSION 3.0)

INCLUDE(${CMAKE_ROOT}/Modules/ExternalProject.cmake)
INCLUDE(external/libseccomp.cmake)
INCLUDE(external/scdoc.cmake)
INCLUDE(external/libcap.cmake)

SET(CMAKE_C_FLAGS "-std=gnu99 -Wall -static")
SET(CMAKE_C_FLAGS_DEBUG "-g -pedantic")
SET(CMAKE_C_FLAGS_RELEASE "-O2")
SET(CMAKE_CXX_FLAGS "-std=gnu++14 -Wall -static")
SET(CMAKE_CXX_FLAGS_DEBUG "-g -pedantic")
SET(CMAKE_CXX_FLAGS_RELEASE "-O3")

IF(NOT DEFINED INSTALLATION_DIR)
    SET(INSTALLATION_DIR ${CMAKE_CURRENT_SOURCE_DIR}/bin)
ENDIF()

IF(NOT DEFINED MAN_DIR)
    SET(MAN_DIR ${INSTALLATION_DIR}/man)
ENDIF()

EXECUTE_PROCESS(COMMAND uname -r
    OUTPUT_VARIABLE BUILD_KERNEL_RELEASE)
ADD_DEFINITIONS('-DBUILD_KERNEL_RELEASE="${BUILD_KERNEL_RELEASE}"')

ENABLE_TESTING()

ADD_SUBDIRECTORY(src)
ADD_SUBDIRECTORY(doc)
ADD_SUBDIRECTORY(boxes)
ADD_SUBDIRECTORY(test)
